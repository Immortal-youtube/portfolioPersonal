{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.redactConnectionString = exports.redactValidConnectionString = void 0;\n\nconst index_1 = __importStar(require(\"./index\"));\n\nfunction redactValidConnectionString(inputUrl, options) {\n  var _a, _b;\n\n  const url = inputUrl.clone();\n  const replacementString = (_a = options === null || options === void 0 ? void 0 : options.replacementString) !== null && _a !== void 0 ? _a : '_credentials_';\n  const redactUsernames = (_b = options === null || options === void 0 ? void 0 : options.redactUsernames) !== null && _b !== void 0 ? _b : true;\n\n  if ((url.username || url.password) && redactUsernames) {\n    url.username = replacementString;\n    url.password = '';\n  } else if (url.password) {\n    url.password = replacementString;\n  }\n\n  if (url.searchParams.has('authMechanismProperties')) {\n    const props = new index_1.CommaAndColonSeparatedRecord(url.searchParams.get('authMechanismProperties'));\n\n    if (props.get('AWS_SESSION_TOKEN')) {\n      props.set('AWS_SESSION_TOKEN', replacementString);\n      url.searchParams.set('authMechanismProperties', props.toString());\n    }\n  }\n\n  if (url.searchParams.has('tlsCertificateKeyFilePassword')) {\n    url.searchParams.set('tlsCertificateKeyFilePassword', replacementString);\n  }\n\n  if (url.searchParams.has('proxyUsername') && redactUsernames) {\n    url.searchParams.set('proxyUsername', replacementString);\n  }\n\n  if (url.searchParams.has('proxyPassword')) {\n    url.searchParams.set('proxyPassword', replacementString);\n  }\n\n  return url;\n}\n\nexports.redactValidConnectionString = redactValidConnectionString;\n\nfunction redactConnectionString(uri, options) {\n  var _a, _b;\n\n  const replacementString = (_a = options === null || options === void 0 ? void 0 : options.replacementString) !== null && _a !== void 0 ? _a : '<credentials>';\n  const redactUsernames = (_b = options === null || options === void 0 ? void 0 : options.redactUsernames) !== null && _b !== void 0 ? _b : true;\n  let parsed;\n\n  try {\n    parsed = new index_1.default(uri);\n  } catch (_c) {}\n\n  if (parsed) {\n    options = { ...options,\n      replacementString: '___credentials___'\n    };\n    return parsed.redact(options).toString().replace(/___credentials___/g, replacementString);\n  }\n\n  const R = replacementString;\n  const replacements = [uri => uri.replace(redactUsernames ? /(\\/\\/)(.*)(@)/g : /(\\/\\/[^@]*:)(.*)(@)/g, `$1${R}$3`), uri => uri.replace(/(AWS_SESSION_TOKEN(:|%3A))([^,&]+)/gi, `$1${R}`), uri => uri.replace(/(tlsCertificateKeyFilePassword=)([^&]+)/gi, `$1${R}`), uri => redactUsernames ? uri.replace(/(proxyUsername=)([^&]+)/gi, `$1${R}`) : uri, uri => uri.replace(/(proxyPassword=)([^&]+)/gi, `$1${R}`)];\n\n  for (const replacer of replacements) {\n    uri = replacer(uri);\n  }\n\n  return uri;\n}\n\nexports.redactConnectionString = redactConnectionString;","map":{"version":3,"mappings":"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","names":["redactValidConnectionString","inputUrl","options","url","clone","replacementString","_a","redactUsernames","_b","username","password","searchParams","has","props","index_1","get","set","toString","exports","redactConnectionString","uri","parsed","redact","replace","R","replacements","replacer"],"sources":["../src/redact.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}