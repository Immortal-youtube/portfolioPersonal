{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AddUserOperation = void 0;\n\nconst crypto = require(\"crypto\");\n\nconst error_1 = require(\"../error\");\n\nconst utils_1 = require(\"../utils\");\n\nconst command_1 = require(\"./command\");\n\nconst operation_1 = require(\"./operation\");\n/** @internal */\n\n\nclass AddUserOperation extends command_1.CommandOperation {\n  constructor(db, username, password, options) {\n    super(db, options);\n    this.db = db;\n    this.username = username;\n    this.password = password;\n    this.options = options ?? {};\n  }\n\n  execute(server, session, callback) {\n    const db = this.db;\n    const username = this.username;\n    const password = this.password;\n    const options = this.options; // Error out if digestPassword set\n    // v5 removed the digestPassword option from AddUserOptions but we still want to throw\n    // an error when digestPassword is provided.\n\n    if ('digestPassword' in options && options.digestPassword != null) {\n      return callback(new error_1.MongoInvalidArgumentError('Option \"digestPassword\" not supported via addUser, use db.command(...) instead'));\n    }\n\n    let roles;\n\n    if (!options.roles || Array.isArray(options.roles) && options.roles.length === 0) {\n      (0, utils_1.emitWarningOnce)('Creating a user without roles is deprecated. Defaults to \"root\" if db is \"admin\" or \"dbOwner\" otherwise');\n\n      if (db.databaseName.toLowerCase() === 'admin') {\n        roles = ['root'];\n      } else {\n        roles = ['dbOwner'];\n      }\n    } else {\n      roles = Array.isArray(options.roles) ? options.roles : [options.roles];\n    }\n\n    let topology;\n\n    try {\n      topology = (0, utils_1.getTopology)(db);\n    } catch (error) {\n      return callback(error);\n    }\n\n    const digestPassword = topology.lastHello().maxWireVersion >= 7;\n    let userPassword = password;\n\n    if (!digestPassword) {\n      // Use node md5 generator\n      const md5 = crypto.createHash('md5'); // Generate keys used for authentication\n\n      md5.update(`${username}:mongo:${password}`);\n      userPassword = md5.digest('hex');\n    } // Build the command to execute\n\n\n    const command = {\n      createUser: username,\n      customData: options.customData || {},\n      roles: roles,\n      digestPassword\n    }; // No password\n\n    if (typeof password === 'string') {\n      command.pwd = userPassword;\n    }\n\n    super.executeCommand(server, session, command, callback);\n  }\n\n}\n\nexports.AddUserOperation = AddUserOperation;\n(0, operation_1.defineAspects)(AddUserOperation, [operation_1.Aspect.WRITE_OPERATION]);","map":{"version":3,"mappings":";;;;;;;AAAA;;AAIA;;AAGA;;AACA;;AACA;AAqBA;;;AACA,MAAaA,gBAAb,SAAsCC,0BAAtC,CAAgE;EAM9DC,YAAYC,EAAZ,EAAoBC,QAApB,EAAsCC,QAAtC,EAAoEC,OAApE,EAA4F;IAC1F,MAAMH,EAAN,EAAUG,OAAV;IAEA,KAAKH,EAAL,GAAUA,EAAV;IACA,KAAKC,QAAL,GAAgBA,QAAhB;IACA,KAAKC,QAAL,GAAgBA,QAAhB;IACA,KAAKC,OAAL,GAAeA,OAAO,IAAI,EAA1B;EACD;;EAEQC,OAAO,CACdC,MADc,EAEdC,OAFc,EAGdC,QAHc,EAGc;IAE5B,MAAMP,EAAE,GAAG,KAAKA,EAAhB;IACA,MAAMC,QAAQ,GAAG,KAAKA,QAAtB;IACA,MAAMC,QAAQ,GAAG,KAAKA,QAAtB;IACA,MAAMC,OAAO,GAAG,KAAKA,OAArB,CAL4B,CAO5B;IACA;IACA;;IACA,IAAI,oBAAoBA,OAApB,IAA+BA,OAAO,CAACK,cAAR,IAA0B,IAA7D,EAAmE;MACjE,OAAOD,QAAQ,CACb,IAAIE,iCAAJ,CACE,gFADF,CADa,CAAf;IAKD;;IAED,IAAIC,KAAJ;;IACA,IAAI,CAACP,OAAO,CAACO,KAAT,IAAmBC,KAAK,CAACC,OAAN,CAAcT,OAAO,CAACO,KAAtB,KAAgCP,OAAO,CAACO,KAAR,CAAcG,MAAd,KAAyB,CAAhF,EAAoF;MAClF,6BACE,yGADF;;MAGA,IAAIb,EAAE,CAACc,YAAH,CAAgBC,WAAhB,OAAkC,OAAtC,EAA+C;QAC7CL,KAAK,GAAG,CAAC,MAAD,CAAR;MACD,CAFD,MAEO;QACLA,KAAK,GAAG,CAAC,SAAD,CAAR;MACD;IACF,CATD,MASO;MACLA,KAAK,GAAGC,KAAK,CAACC,OAAN,CAAcT,OAAO,CAACO,KAAtB,IAA+BP,OAAO,CAACO,KAAvC,GAA+C,CAACP,OAAO,CAACO,KAAT,CAAvD;IACD;;IAED,IAAIM,QAAJ;;IACA,IAAI;MACFA,QAAQ,GAAG,yBAAYhB,EAAZ,CAAX;IACD,CAFD,CAEE,OAAOiB,KAAP,EAAc;MACd,OAAOV,QAAQ,CAACU,KAAD,CAAf;IACD;;IAED,MAAMT,cAAc,GAAGQ,QAAQ,CAACE,SAAT,GAAqBC,cAArB,IAAuC,CAA9D;IAEA,IAAIC,YAAY,GAAGlB,QAAnB;;IAEA,IAAI,CAACM,cAAL,EAAqB;MACnB;MACA,MAAMa,GAAG,GAAGC,MAAM,CAACC,UAAP,CAAkB,KAAlB,CAAZ,CAFmB,CAGnB;;MACAF,GAAG,CAACG,MAAJ,CAAW,GAAGvB,QAAQ,UAAUC,QAAQ,EAAxC;MACAkB,YAAY,GAAGC,GAAG,CAACI,MAAJ,CAAW,KAAX,CAAf;IACD,CAjD2B,CAmD5B;;;IACA,MAAMC,OAAO,GAAa;MACxBC,UAAU,EAAE1B,QADY;MAExB2B,UAAU,EAAEzB,OAAO,CAACyB,UAAR,IAAsB,EAFV;MAGxBlB,KAAK,EAAEA,KAHiB;MAIxBF;IAJwB,CAA1B,CApD4B,CA2D5B;;IACA,IAAI,OAAON,QAAP,KAAoB,QAAxB,EAAkC;MAChCwB,OAAO,CAACG,GAAR,GAAcT,YAAd;IACD;;IAED,MAAMU,cAAN,CAAqBzB,MAArB,EAA6BC,OAA7B,EAAsCoB,OAAtC,EAA+CnB,QAA/C;EACD;;AAnF6D;;AAAhEwB;AAsFA,+BAAclC,gBAAd,EAAgC,CAACmC,mBAAOC,eAAR,CAAhC","names":["AddUserOperation","command_1","constructor","db","username","password","options","execute","server","session","callback","digestPassword","error_1","roles","Array","isArray","length","databaseName","toLowerCase","topology","error","lastHello","maxWireVersion","userPassword","md5","crypto","createHash","update","digest","command","createUser","customData","pwd","executeCommand","exports","operation_1","WRITE_OPERATION"],"sources":["C:\\Users\\anshs\\OneDrive\\Documents\\Code\\WebDevelopement\\portfolioPersonal\\node_modules\\mongodb\\src\\operations\\add_user.ts"],"sourcesContent":["import * as crypto from 'crypto';\n\nimport type { Document } from '../bson';\nimport type { Db } from '../db';\nimport { MongoInvalidArgumentError } from '../error';\nimport type { Server } from '../sdam/server';\nimport type { ClientSession } from '../sessions';\nimport { Callback, emitWarningOnce, getTopology } from '../utils';\nimport { CommandOperation, CommandOperationOptions } from './command';\nimport { Aspect, defineAspects } from './operation';\n\n/** @public */\nexport interface RoleSpecification {\n  /**\n   * A role grants privileges to perform sets of actions on defined resources.\n   * A given role applies to the database on which it is defined and can grant access down to a collection level of granularity.\n   */\n  role: string;\n  /** The database this user's role should effect. */\n  db: string;\n}\n\n/** @public */\nexport interface AddUserOptions extends CommandOperationOptions {\n  /** Roles associated with the created user */\n  roles?: string | string[] | RoleSpecification | RoleSpecification[];\n  /** Custom data associated with the user (only Mongodb 2.6 or higher) */\n  customData?: Document;\n}\n\n/** @internal */\nexport class AddUserOperation extends CommandOperation<Document> {\n  override options: AddUserOptions;\n  db: Db;\n  username: string;\n  password?: string;\n\n  constructor(db: Db, username: string, password: string | undefined, options?: AddUserOptions) {\n    super(db, options);\n\n    this.db = db;\n    this.username = username;\n    this.password = password;\n    this.options = options ?? {};\n  }\n\n  override execute(\n    server: Server,\n    session: ClientSession | undefined,\n    callback: Callback<Document>\n  ): void {\n    const db = this.db;\n    const username = this.username;\n    const password = this.password;\n    const options = this.options;\n\n    // Error out if digestPassword set\n    // v5 removed the digestPassword option from AddUserOptions but we still want to throw\n    // an error when digestPassword is provided.\n    if ('digestPassword' in options && options.digestPassword != null) {\n      return callback(\n        new MongoInvalidArgumentError(\n          'Option \"digestPassword\" not supported via addUser, use db.command(...) instead'\n        )\n      );\n    }\n\n    let roles;\n    if (!options.roles || (Array.isArray(options.roles) && options.roles.length === 0)) {\n      emitWarningOnce(\n        'Creating a user without roles is deprecated. Defaults to \"root\" if db is \"admin\" or \"dbOwner\" otherwise'\n      );\n      if (db.databaseName.toLowerCase() === 'admin') {\n        roles = ['root'];\n      } else {\n        roles = ['dbOwner'];\n      }\n    } else {\n      roles = Array.isArray(options.roles) ? options.roles : [options.roles];\n    }\n\n    let topology;\n    try {\n      topology = getTopology(db);\n    } catch (error) {\n      return callback(error);\n    }\n\n    const digestPassword = topology.lastHello().maxWireVersion >= 7;\n\n    let userPassword = password;\n\n    if (!digestPassword) {\n      // Use node md5 generator\n      const md5 = crypto.createHash('md5');\n      // Generate keys used for authentication\n      md5.update(`${username}:mongo:${password}`);\n      userPassword = md5.digest('hex');\n    }\n\n    // Build the command to execute\n    const command: Document = {\n      createUser: username,\n      customData: options.customData || {},\n      roles: roles,\n      digestPassword\n    };\n\n    // No password\n    if (typeof password === 'string') {\n      command.pwd = userPassword;\n    }\n\n    super.executeCommand(server, session, command, callback);\n  }\n}\n\ndefineAspects(AddUserOperation, [Aspect.WRITE_OPERATION]);\n"]},"metadata":{},"sourceType":"script"}